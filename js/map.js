function addPredefinedMaps(e){predefinedMaps.addData(e);predefinedMaps.eachLayer(function(e){e.name=e.feature.properties.name;e.description=e.feature.properties.description;e.areaId=areaId;e.predefined=true;e.on("mouseover",function(t){e.setStyle(hiStyle)});e.on("mouseout",function(t){e.setStyle(myStyle)});e.on("click",function(t){currentSelectedLayer=e;e.setStyle(clickStyle);map.fitBounds(e.getBounds())});var t="<h5>"+e.name+"</h5><p>"+e.description+'</p><p><a href="javascript:void(0)" onclick="addToBasket(currentSelectedLayer)">Legg i kurv</a></p>';e.bindPopup(t)})}function addToBasket(e){drawnItems.removeLayer(e);basketGroup.addLayer(e);e.on("mouseout",function(t){e.setStyle(showStyle)});e.setStyle(showStyle);e.closePopup();e.basketId=basketId++;e.numMaps=1;var t=$("#basketControls");var n=document.createElement("a");n.href="javascript:void(0)";n.onclick=function(){showLayer(e)};n.id="basketLayerLink-"+e.basketId;n.innerHTML=e.name;t.prepend(n);$("#mapList").after(createMapDivs(e));var r='<h4 class="mapTitle">'+e.name+'</h4><a href="javascript:void(0)" onclick="removeFromBasket(currentSelectedLayer)">Fjern fra kurv</a>';e.bindPopup(r)}function showLayer(e){if(!map.hasLayer(e)){e.addTo(map)}map.fitBounds(e.getBounds())}function createMapDivs(e){var t=document.createElement("div");t.id="orderMapRow-"+e.basketId;t.className="row-fluid";var n=document.createElement("div");n.className="span9";var r=document.createElement("div");r.className="span2";var i=document.createElement("input");i.type="text";i.value="1";i.className="tinyInput";i.onkeyup=function(){e.numMaps=this.value};r.appendChild(i);var s=document.createElement("div");s.className="span1";var o=document.createElement("a");o.innerHTML=e.name;o.href="javascript:void(0)";o.onclick=function(){showLayer(e)};var u=document.createElement("a");u.innerHTML="Slett";u.href="javascript:void(0)";u.onclick=function(){removeFromBasket(e)};var a=document.forms["submitOrder"];var f=document.createElement("p");f.appendChild(o);var l=document.createElement("p");l.appendChild(u);n.appendChild(f);s.appendChild(l);t.appendChild(n);t.appendChild(r);t.appendChild(s);return t}function checkInputsIsSet(e){var t=true;for(var n=0;n<e.length;n++){var r=document.getElementById(e[n]);if(r.value==""){$(r).addClass("missingInput");var t=false}}return t}function submitOrderForm(){var e=document.forms["submitOrder"];var t=false;basketGroup.eachLayer(function(n){var r=document.createElement("input");r.name="mapNames[]";r.value=n.name;r.type="hidden";e.appendChild(r);var i=document.createElement("input");i.name="mapAreas[]";i.value=n.areaId;i.type="hidden";e.appendChild(i);var s=document.createElement("input");s.name="mapPolygons[]";s.value=latLngsToMysqlString(n.getLatLngs());s.type="hidden";e.appendChild(s);var o=document.createElement("input");o.name="numMaps[]";o.value=n.numMaps;o.type="hidden";e.appendChild(o);t=true});var n=["orderName","orderStreet","orderPostnr","orderPlace","orderEmail","orderTel"];if(checkInputsIsSet(n)&&t){e.submit()}}function removeFromBasket(e){$("#basketLayerLink-"+e.basketId).remove();$("#orderMapRow-"+e.basketId).remove();basketGroup.removeLayer(e);e.on("mouseout",function(t){e.setStyle(myStyle)});e.setStyle(myStyle);e.closePopup();if(!e.predefined){var t='<a href="javascript:void(0)" onclick="deleteDrawnLayer(currentSelectedLayer)">Slett</a> - <a href="javascript:void(0)" onclick="addToBasket(currentSelectedLayer)">Legg i kurv</a>';drawnItems.addLayer(e)}else{var t="<h5>"+e.name+"</h5><p>"+e.description+'</p><p><a href="javascript:void(0)" onclick="addToBasket(currentSelectedLayer)">Legg i kurv</a></p>';layerGroup.addLayer(e)}e.bindPopup(t)}function retriveGeoJsonArea(e){var t=L.featureGroup();geoJsons.eachLayer(function(n){if(e==parseInt(n.feature.properties.areaid)){t.addLayer(n)}});map.fitBounds(t.getBounds());map.closePopup()}function deleteDrawnLayer(e){drawnItems.removeLayer(e)}function showOrders(){basketGroup.addTo(map);basketGroup.eachLayer(function(e){e.setStyle(showStyle);var t='<h4 class="mapTitle">'+e.name+'</h4><a href="javascript:void(0)" onclick="removeFromBasket(currentSelectedLayer)">Remove from basket</a>';e.bindPopup(t);e.on("mouseout",function(t){e.setStyle(showStyle)})});map.fitBounds(basketGroup.getBounds())}function emptyBasket(){basketGroup.eachLayer(function(e){removeFromBasket(e)});basketGroup.clearLayers()}function showOrderForm(){var e=$("#map");var t=$("#orderFormContainer");var n=$("#menus");n.removeClass("span2");n.addClass("hidden");e.removeClass("span10");e.addClass("span6");t.removeClass("hidden");t.addClass("span6");map.invalidateSize();showOrders()}function closeOrderForm(){var e=$("#map");var t=$("#orderFormContainer");var n=$("#menus");n.addClass("span2");n.removeClass("hidden");e.addClass("span10");e.removeClass("span6");t.addClass("hidden");t.removeClass("span6");map.invalidateSize()}function doRest(){layerGroup.addTo(map);basketGroup.addTo(map);geoJson=L.geoJson();drawControl.addTo(map);map.on("draw:drawstart",function(e){map.removeLayer(predefinedMaps)});map.on("draw:drawstop",function(e){map.addLayer(predefinedMaps)});map.on("draw:created",function(e){var t=e.layerType,n=e.layer;if(t==="polyline"){var r=n.getLatLngs();var i="";for(var s=0;s<r.length-1;s++){i+=r[s].lat+","+r[s].lng+"|"}i+=r[r.length-1].lat+","+r[r.length-1].lng+"";alert(i)}n.setStyle(myStyle);n.areaId=areaId;drawnItems.addLayer(n);n.predefined=false;n.on("mouseover",function(e){n.setStyle(hiStyle)});n.on("mouseout",function(e){n.setStyle(myStyle)});n.on("click",function(e){drawnItemToGeoJsonFeature(n);currentSelectedLayer=n});drawnItemsCounter++;n.name="Egendefinert "+drawnItemsCounter;var o='<a href="javascript:void(0)" onclick="deleteDrawnLayer(currentSelectedLayer)">Slett</a> - <a href="javascript:void(0)" onclick="addToBasket(currentSelectedLayer)">Legg i kurv</a>';n.bindPopup(o);n.openPopup();currentSelectedLayer=n;drawnItems.bringToFront()});displayAllTiles();var e=L.marker();$("#helpBox").html(settings.textboks);map.on("popupclose",function(t){if(map.hasLayer(e)){map.removeLayer(e)}});addPredefinedMaps(maps);predefinedMaps.addTo(map);predefinedMaps.bringToFront();if(hash.indexOf("area-")>-1){areaId=parseInt(hash.replace("area-",""));window.setTimeout(retriveGeoJsonArea,1e3,areaId)}else{e=L.marker([parseFloat(settings.centerLat),parseFloat(settings.centerLong)]).addTo(map).bindPopup(settings.markertext).openPopup()}}var geoJson;var basketGroup=L.featureGroup();var layerGroup=L.featureGroup();var basketId=0;var predefinedMaps=L.geoJson("",{style:myStyle,minZoom:10});var areaId